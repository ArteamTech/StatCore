---
description:
globs:
alwaysApply: false
---
# StatCore API 结构详解

## 核心接口

### 属性接口体系
- **StatAttribute**：属性基本接口
  - `id`: ResourceLocation - 属性唯一标识符
  - `defaultValue`: Double - 属性默认值
  - `minValue`: Double - 属性最小值
  - `maxValue`: Double - 属性最大值
  - `isStackable`: Boolean - 是否可叠加
  - `calculate(base: Double, modifiers: List<AttributeModifier>): Double` - 计算属性值

- **AttributeModifier**：属性修改器接口
  - `id`: UUID - 修改器唯一ID
  - `name`: String - 修改器名称
  - `amount`: Double - 修改量
  - `operation`: ModifierOperation - 操作类型
  - `priority`: Int - 优先级

- **AttributeInstance**：属性实例接口
  - `attribute`: StatAttribute - 关联的属性
  - `baseValue`: Double - 基础值
  - `modifiers`: List<AttributeModifier> - 修改器列表
  - `value`: Double - 计算后的最终值
  - `addModifier(modifier: AttributeModifier)` - 添加修改器
  - `removeModifier(id: UUID)` - 移除修改器
  - `hasModifier(id: UUID): Boolean` - 检查修改器是否存在

### 注册接口
- **AttributeRegistry**：属性注册表接口
  - `register(attribute: StatAttribute): StatAttribute` - 注册属性
  - `getAttributes(): Collection<StatAttribute>` - 获取所有属性
  - `getAttribute(id: ResourceLocation): StatAttribute?` - 根据ID获取属性

### 修改器操作类型
- **ModifierOperation**：修改器操作类型枚举
  - `ADDITION` - 加法操作
  - `MULTIPLY` - 乘法操作

## 核心实现

### 属性实现
- **BaseStatAttribute**：基本属性实现类
  - 实现了StatAttribute接口的基础功能
  - 提供默认的计算逻辑

- **EntityTypeCheckAttribute**：实体类型检查属性
  - 继承自BaseStatAttribute
  - 添加了实体类型检查功能，可以为不同实体类型设置不同的默认值

### 注册实现
- **AttributeRegistryImpl**：属性注册表实现
  - 单例对象，管理所有注册的属性
  - 提供注册和查询功能

### 属性实例实现
- **AttributeInstanceImpl**：属性实例实现
  - 实现了AttributeInstance接口
  - 管理修改器并计算最终属性值

## 具体属性

### 生命值属性
- **HealthAttribute**：生命值属性
  - 玩家默认100点生命值
  - 其他生物为原版生命值的5倍

### 防御属性
- **DefenseType**：防御类型枚举
  - `PHYSICAL` - 物理防御
  - `PROJECTILE` - 弹射物防御
  - `EXPLOSION` - 爆炸防御
  - `FIRE` - 火焰防御
  - `TRUE` - 真实防御

- **DefenseAttribute**：防御属性
  - 基于防御类型的不同防御属性
  - 计算公式：防御值 / (防御值 + 100)

## 事件系统

### 属性事件
- **AttributeChangeEvent**：属性变更事件
  - 当属性值变化时触发
  - 包含实体、属性和新旧值信息

- **AttributeSyncEvent**：属性同步事件
  - 当属性需要同步到客户端时触发
  - 包含同步数据包信息

### 装备事件
- **EquipmentChangeEvent**：装备变更事件
  - 当实体装备变更时触发
  - 用于更新基于装备的属性修改器

## 同步系统

- **ImmediateSyncManager**：立即同步管理器
  - 处理属性变更的实时同步
  - 发送属性同步数据包

## 命令系统

- **StatCommand**：属性查看命令
  - `/stat [entity]` - 查看实体的属性信息
  - 支持玩家自查和管理员查看其他实体
